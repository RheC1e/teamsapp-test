# 解決第二個用戶端應用程式新增失敗的問題

## 🔍 問題分析

錯誤訊息：「Property PreAuthorizedApplication references applications 5e3ce6c0-2b1f-4285-8d4b-75ef474d30e3 that cannot be found」

這表示 Azure 找不到這個用戶端應用程式 ID。

## ✅ 解決方案

### 方案 1：只使用桌面版用戶端（推薦）

**實際上，Teams 桌面版和網頁版可能共用同一個用戶端 ID，或者只需要桌面版的用戶端就足夠了。**

如果第一個用戶端（桌面版：`1fec8e78-bce4-4aaf-ab1b-5451cc387264`）已經成功新增，**可以先測試看看是否足夠**。

### 方案 2：檢查是否已存在

1. **在「授權的用戶端應用程式」列表中**
   - 檢查是否已經有 `5e3ce6c0-2b1f-4285-8d4b-75ef474d30e3` 這個 ID
   - 如果已存在，就不需要重新新增

### 方案 3：使用正確的用戶端 ID

如果確實需要兩個用戶端，可能需要使用不同的 ID。根據 Microsoft 文檔：

- **Teams 桌面版：** `1fec8e78-bce4-4aaf-ab1b-5451cc387264` ✅（已成功）
- **Teams 網頁版：** 可能不需要單獨的用戶端，或使用相同的 ID

## 🧪 測試步驟

### 1. 先測試現有設定

既然第一個用戶端已經成功新增，請：

1. **清除 Teams 快取**
   - 桌面版：關閉 Teams，刪除 `%appdata%\Microsoft\Teams`（Windows）或 `~/Library/Application Support/Microsoft/Teams`（Mac）
   - 網頁版：清除瀏覽器快取和 Cookies

2. **重新啟動 Teams**

3. **測試應用程式**
   - 先在桌面版測試
   - 再在網頁版測試

### 2. 如果網頁版仍有問題

如果網頁版仍然出現錯誤，可能需要：

1. **檢查「授權的用戶端應用程式」列表**
   - 確認桌面版用戶端已正確設定
   - 確認範圍已正確勾選

2. **確認應用程式識別碼 URI**
   - 必須是：`api://teams-sso-test-rho.vercel.app/33abd69a-d012-498a-bddb-8608cbf10c2d`

3. **確認範圍**
   - `access_as_user` 範圍必須存在且已啟用

## 📋 目前狀態檢查

請確認以下項目：

- [x] 應用程式識別碼 URI 已設定 ✅
- [x] `access_as_user` 範圍已存在 ✅
- [x] Teams 桌面版用戶端已新增 ✅（`1fec8e78-bce4-4aaf-ab1b-5451cc387264`）
- [ ] Teams 網頁版用戶端（可能不需要，或已存在）

## 💡 建議

**先測試看看只有桌面版用戶端是否足夠。** 如果網頁版也能正常運作，就不需要新增第二個用戶端了。

如果網頁版仍然有問題，請告訴我具體的錯誤訊息，我可以幫您進一步排查。

