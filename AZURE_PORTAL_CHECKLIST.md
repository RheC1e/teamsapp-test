# Azure Portal è¨­å®šæª¢æŸ¥æ¸…å–®

## âš ï¸ é‡è¦ï¼šå¿…é ˆæª¢æŸ¥çš„è¨­å®š

### 1. æ‡‰ç”¨ç¨‹å¼è­˜åˆ¥ç¢¼ URIï¼ˆApplication ID URIï¼‰

**ä½ç½®ï¼š** Azure Portal > Azure Active Directory > æ‡‰ç”¨ç¨‹å¼è¨»å†Š > æ‚¨çš„æ‡‰ç”¨ç¨‹å¼ > **å…¬é–‹ API**

**å¿…é ˆè¨­å®šç‚ºï¼š**
```
api://teams-sso-test-rho.vercel.app/33abd69a-d012-498a-bddb-8608cbf10c2d
```

**æª¢æŸ¥æ­¥é©Ÿï¼š**
1. ç™»å…¥ Azure Portalï¼šhttps://portal.azure.com
2. å°èˆªåˆ°ï¼šAzure Active Directory > æ‡‰ç”¨ç¨‹å¼è¨»å†Š
3. æ‰¾åˆ°æ‡‰ç”¨ç¨‹å¼ï¼š`33abd69a-d012-498a-bddb-8608cbf10c2d`
4. é»æ“Šå·¦å´é¸å–®çš„ã€Œå…¬é–‹ APIã€
5. ç¢ºèªã€Œæ‡‰ç”¨ç¨‹å¼è­˜åˆ¥ç¢¼ URIã€å·²è¨­å®šç‚ºä¸Šè¿°å€¼
6. å¦‚æœæ²’æœ‰ï¼Œé»æ“Šã€Œè¨­å®šã€ä¸¦æ–°å¢

### 2. ç¯„åœï¼ˆScopesï¼‰

**ä½ç½®ï¼š** Azure Portal > Azure Active Directory > æ‡‰ç”¨ç¨‹å¼è¨»å†Š > æ‚¨çš„æ‡‰ç”¨ç¨‹å¼ > **å…¬é–‹ API > ç¯„åœ**

**å¿…é ˆæ–°å¢çš„ç¯„åœï¼š**
- **ç¯„åœåç¨±ï¼š** `access_as_user`
- **èª°å¯ä»¥åŒæ„ï¼š** ç®¡ç†å“¡å’Œä½¿ç”¨è€…
- **ç®¡ç†å“¡åŒæ„é¡¯ç¤ºåç¨±ï¼š** `Teams å¯ä»¥ä»¥ä½¿ç”¨è€…èº«åˆ†å­˜å–æ‡‰ç”¨ç¨‹å¼`
- **ç®¡ç†å“¡åŒæ„æè¿°ï¼š** `å…è¨± Teams ä»¥ç™»å…¥ä½¿ç”¨è€…çš„èº«åˆ†å‘¼å«æ‡‰ç”¨ç¨‹å¼çš„ API`
- **ä½¿ç”¨è€…åŒæ„é¡¯ç¤ºåç¨±ï¼š** `Teams å¯ä»¥ä»¥æ‚¨çš„èº«åˆ†å­˜å–æ‡‰ç”¨ç¨‹å¼`
- **ä½¿ç”¨è€…åŒæ„æè¿°ï¼š** `å…è¨± Teams ä»¥æ‚¨çš„èº«åˆ†å‘¼å«æ‡‰ç”¨ç¨‹å¼çš„ API`
- **ç‹€æ…‹ï¼š** å·²å•Ÿç”¨

**æª¢æŸ¥æ­¥é©Ÿï¼š**
1. åœ¨ã€Œå…¬é–‹ APIã€é é¢ä¸­ï¼Œæ‰¾åˆ°ã€Œç¯„åœã€å€å¡Š
2. ç¢ºèªå·²æ–°å¢ä¸Šè¿°ç¯„åœ
3. å¦‚æœæ²’æœ‰ï¼Œé»æ“Šã€Œæ–°å¢ç¯„åœã€ä¸¦å¡«å¯«ä¸Šè¿°è³‡è¨Š

### 3. æˆæ¬Šçš„ç”¨æˆ¶ç«¯æ‡‰ç”¨ç¨‹å¼ï¼ˆAuthorized client applicationsï¼‰

**ä½ç½®ï¼š** Azure Portal > Azure Active Directory > æ‡‰ç”¨ç¨‹å¼è¨»å†Š > æ‚¨çš„æ‡‰ç”¨ç¨‹å¼ > **å…¬é–‹ API > æˆæ¬Šçš„ç”¨æˆ¶ç«¯æ‡‰ç”¨ç¨‹å¼**

**å¿…é ˆæ–°å¢çš„ç”¨æˆ¶ç«¯ï¼š**
- **ç”¨æˆ¶ç«¯è­˜åˆ¥ç¢¼ï¼š** `1fec8e78-bce4-4aaf-ab1b-5451cc387264`ï¼ˆé€™æ˜¯ Teams æ¡Œé¢ç‰ˆçš„ç”¨æˆ¶ç«¯ IDï¼‰
- **ç”¨æˆ¶ç«¯è­˜åˆ¥ç¢¼ï¼š** `5e3ce6c0-2b1f-4285-8d4b-75ef474d30e3`ï¼ˆé€™æ˜¯ Teams ç¶²é ç‰ˆçš„ç”¨æˆ¶ç«¯ IDï¼‰

**æª¢æŸ¥æ­¥é©Ÿï¼š**
1. åœ¨ã€Œå…¬é–‹ APIã€é é¢ä¸­ï¼Œæ‰¾åˆ°ã€Œæˆæ¬Šçš„ç”¨æˆ¶ç«¯æ‡‰ç”¨ç¨‹å¼ã€å€å¡Š
2. é»æ“Šã€Œæ–°å¢ç”¨æˆ¶ç«¯æ‡‰ç”¨ç¨‹å¼ã€
3. æ–°å¢ä¸Šè¿°å…©å€‹ç”¨æˆ¶ç«¯ ID
4. ç‚ºæ¯å€‹ç”¨æˆ¶ç«¯é¸æ“‡ç¯„åœï¼š`api://teams-sso-test-rho.vercel.app/33abd69a-d012-498a-bddb-8608cbf10c2d/access_as_user`

### 4. API æ¬Šé™ï¼ˆAPI Permissionsï¼‰

**ä½ç½®ï¼š** Azure Portal > Azure Active Directory > æ‡‰ç”¨ç¨‹å¼è¨»å†Š > æ‚¨çš„æ‡‰ç”¨ç¨‹å¼ > **API æ¬Šé™**

**å¿…é ˆçš„æ¬Šé™ï¼š**
- âœ… `User.Read`ï¼ˆMicrosoft Graphï¼‰
- âœ… `profile`ï¼ˆMicrosoft Graphï¼‰
- âœ… `email`ï¼ˆMicrosoft Graphï¼‰

**æª¢æŸ¥æ­¥é©Ÿï¼š**
1. ç¢ºèªä¸Šè¿°æ¬Šé™éƒ½å·²æ–°å¢
2. ç¢ºèªæ‰€æœ‰æ¬Šé™éƒ½å·²ç²å¾—ã€Œç®¡ç†å“¡åŒæ„ã€
3. å¦‚æœæ²’æœ‰ï¼Œé»æ“Šã€Œç‚º [ç§Ÿç”¨æˆ¶åç¨±] æˆèˆ‡ç®¡ç†å“¡åŒæ„ã€

### 5. é©—è­‰ï¼ˆAuthenticationï¼‰

**ä½ç½®ï¼š** Azure Portal > Azure Active Directory > æ‡‰ç”¨ç¨‹å¼è¨»å†Š > æ‚¨çš„æ‡‰ç”¨ç¨‹å¼ > **é©—è­‰**

**å¿…é ˆçš„é‡æ–°å°å‘ URIï¼š**
- âœ… `https://teams-sso-test-rho.vercel.app`ï¼ˆSPA é¡å‹ï¼‰

**æª¢æŸ¥æ­¥é©Ÿï¼š**
1. ç¢ºèªå·²æ–°å¢ä¸Šè¿° Redirect URI
2. ç¢ºèªé¡å‹ç‚ºã€Œå–®é æ‡‰ç”¨ç¨‹å¼ï¼ˆSPAï¼‰ã€

## ğŸ” å¸¸è¦‹éŒ¯èª¤èˆ‡è§£æ±ºæ–¹æ¡ˆ

### éŒ¯èª¤ï¼š"The operation attempted is invalid"

**å¯èƒ½åŸå› ï¼š**
1. æ‡‰ç”¨ç¨‹å¼è­˜åˆ¥ç¢¼ URI æœªè¨­å®šæˆ–è¨­å®šéŒ¯èª¤
2. ç¯„åœæœªæ­£ç¢ºè¨­å®š
3. æˆæ¬Šçš„ç”¨æˆ¶ç«¯æ‡‰ç”¨ç¨‹å¼æœªæ–°å¢

**è§£æ±ºæ–¹æ¡ˆï¼š**
1. æª¢æŸ¥ä¸¦è¨­å®šæ‡‰ç”¨ç¨‹å¼è­˜åˆ¥ç¢¼ URI
2. æ–°å¢ `access_as_user` ç¯„åœ
3. æ–°å¢ Teams çš„ç”¨æˆ¶ç«¯æ‡‰ç”¨ç¨‹å¼

### éŒ¯èª¤ï¼šæ¬Šé™è¦æ±‚å°è©±æ¡†æ­»å¾ªç’°

**å¯èƒ½åŸå› ï¼š**
1. ç¯„åœæœªæ­£ç¢ºè¨­å®š
2. æˆæ¬Šçš„ç”¨æˆ¶ç«¯æ‡‰ç”¨ç¨‹å¼æœªæ–°å¢
3. æ¬Šé™æœªç²å¾—ç®¡ç†å“¡åŒæ„

**è§£æ±ºæ–¹æ¡ˆï¼š**
1. æª¢æŸ¥ç¯„åœè¨­å®š
2. æ–°å¢ Teams çš„ç”¨æˆ¶ç«¯æ‡‰ç”¨ç¨‹å¼
3. ç¢ºä¿æ‰€æœ‰æ¬Šé™éƒ½å·²ç²å¾—ç®¡ç†å“¡åŒæ„

## ğŸ“‹ å¿«é€Ÿæª¢æŸ¥æ¸…å–®

- [ ] æ‡‰ç”¨ç¨‹å¼è­˜åˆ¥ç¢¼ URI å·²è¨­å®šç‚ºï¼š`api://teams-sso-test-rho.vercel.app/33abd69a-d012-498a-bddb-8608cbf10c2d`
- [ ] å·²æ–°å¢ `access_as_user` ç¯„åœ
- [ ] å·²æ–°å¢ Teams æ¡Œé¢ç‰ˆç”¨æˆ¶ç«¯æ‡‰ç”¨ç¨‹å¼ï¼ˆ`1fec8e78-bce4-4aaf-ab1b-5451cc387264`ï¼‰
- [ ] å·²æ–°å¢ Teams ç¶²é ç‰ˆç”¨æˆ¶ç«¯æ‡‰ç”¨ç¨‹å¼ï¼ˆ`5e3ce6c0-2b1f-4285-8d4b-75ef474d30e3`ï¼‰
- [ ] æ‰€æœ‰ API æ¬Šé™éƒ½å·²ç²å¾—ç®¡ç†å“¡åŒæ„
- [ ] Redirect URI å·²æ­£ç¢ºè¨­å®š

## ğŸ”— ç›¸é—œè³‡æº

- [Microsoft Teams SSO æ–‡ä»¶](https://docs.microsoft.com/en-us/microsoftteams/platform/tabs/how-to/authentication/auth-aad-sso)
- [Azure AD æ‡‰ç”¨ç¨‹å¼è¨»å†Šæ–‡ä»¶](https://docs.microsoft.com/en-us/azure/active-directory/develop/quickstart-register-app)

